---
sidebar_position: 1
---

# Name Setter Library

`name-setter-lib` is a Solidity library that provides a simple interface for assigning ENS names to contracts. It handles the complete ENS naming flow:

- Subname creation under a parent domain
- Forward resolution (name → address)
- Reverse resolution (address → name)

The library automatically routes to the appropriate ENS contracts based on the chain ID and supports multiple networks including Ethereum Mainnet, Sepolia, Optimism, Arbitrum, Base, Scroll, and Linea.

## Installation

The library can be installed as a dependency in your Foundry project:

```bash
forge install enscribexyz/enscribesol
```

Then add this to your `remappings.txt`:

```toml
enscribesol/=lib/enscribesol/src/
```

## Quick Start

The simplest way to use the library is to import it in your foundry script and call the `setName` function:

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import {Script, console} from "forge-std/Script.sol";
import {Counter} from "../src/Counter.sol";
import {NameSetter} from "enscribesol/Ens.sol";

contract MyContractScript is Script {
    function run() public {
        vm.startBroadcast();

        counter = new Counter();
        Ens.setName(block.chainid, address(counter), "mycontract.mydomain.eth");

        vm.stopBroadcast();
    }
}
```

## Public API

### Core Functions

#### `Ens.setName()`

Sets both forward and reverse resolution for a contract address. This is the main function you'll use in most cases.

**Function Signature:**
```solidity
function setName(
    uint256 chainId,
    address contractAddress,
    string memory fullName
) internal returns (bool success)
```

**Parameters:**
- `chainId`: The chain ID where the contract is deployed (e.g., `1` for Ethereum Mainnet, `8453` for Base Mainnet)
- `contractAddress`: The address of the contract to name (must not be zero address)
- `fullName`: The full ENS name to assign (e.g., `"mycontract.mydomain.eth"`)

**Returns:**
- `success`: `true` if the operation succeeded, `false` otherwise

**What it does:**
1. Creates a subname under the parent domain
2. Sets forward resolution (name → address mapping)
3. Sets reverse resolution (address → name mapping)

**Example:**
```solidity
import {Script, console} from "forge-std/Script.sol";
import {Counter} from "../src/Counter.sol";
import {NameSetter} from "enscribesol/Ens.sol";

contract MyContractScript is Script {
    function run() public {
        vm.startBroadcast();

        counter = new Counter();
        Ens.setName(block.chainid, address(counter), "mycontract.mydomain.eth");

        vm.stopBroadcast();
    }
}
```

**Requirements:**
- The caller (`msg.sender`) must own the parent ENS node (e.g., `mydomain.eth`)
- The `contractAddress` must not be the zero address
- The `fullName` must be a valid ENS name format (contains at least one dot)

---

#### `Ens.setForwardResolution()`

Sets only forward resolution (name → address) without setting reverse resolution. Useful when you only need forward lookup.

**Function Signature:**
```solidity
function setForwardResolution(
    uint256 chainId,
    address contractAddress,
    string memory fullName
) internal returns (bool success)
```

**Parameters:**
- `chainId`: The chain ID where the contract is deployed
- `contractAddress`: The address of the contract to name
- `fullName`: The full ENS name to assign

**Returns:**
- `success`: `true` if the operation succeeded, `false` otherwise

**Example:**
```solidity
import {Script, console} from "forge-std/Script.sol";
import {Counter} from "../src/Counter.sol";
import {NameSetter} from "enscribesol/Ens.sol";

contract MyContractScript is Script {
    function run() public {
        vm.startBroadcast();

        counter = new Counter();
        Ens.setForwardResolution(block.chainid, address(counter), "mycontract.mydomain.eth");

        vm.stopBroadcast();
    }
}
```

---

### Utility Functions

#### `CommonUtils.splitName()`

Splits a full ENS name into its label and parent components.

**Function Signature:**
```solidity
function splitName(string memory fullName) 
    internal pure 
    returns (string memory label, string memory parentName)
```

**Example:**
```solidity
import {CommonUtils} from "name-setter-lib/src/CommonUtils.sol";

(string memory label, string memory parent) = CommonUtils.splitName("myapp.mydomain.eth");
// label = "myapp"
// parent = "mydomain.eth"
```

---

#### `CommonUtils.namehash()`

Calculates the ENS namehash (node) for a given name, following the ENS namehash algorithm.

**Function Signature:**
```solidity
function namehash(string memory name) 
    internal pure 
    returns (bytes32 node)
```

**Example:**
```solidity
bytes32 ethNode = CommonUtils.namehash("eth");
bytes32 myDomainNode = CommonUtils.namehash("mydomain.eth");
```

---

#### Chain ID Constants

The library provides constants for supported chain IDs:

```solidity
CommonUtils.ETHEREUM_MAINNET      // 1
CommonUtils.SEPOLIA               // 11155111
CommonUtils.OPTIMISM_MAINNET      // 10
CommonUtils.OPTIMISM_SEPOLIA      // 11155420
CommonUtils.ARBITRUM_MAINNET      // 42161
CommonUtils.ARBITRUM_SEPOLIA      // 421614
CommonUtils.BASE_MAINNET          // 8453
CommonUtils.BASE_SEPOLIA          // 84532
CommonUtils.SCROLL_MAINNET        // 534352
CommonUtils.SCROLL_SEPOLIA        // 534351
CommonUtils.LINEA_MAINNET         // 59144
CommonUtils.LINEA_SEPOLIA         // 59141
```

**Example:**
```solidity
import {CommonUtils} from "name-setter-lib/src/CommonUtils.sol";

function nameOnBase(address contractAddr) external {
    Ens.setName(
        CommonUtils.BASE_MAINNET,
        contractAddr,
        "myapp.mydomain.eth"
    );
}
```

---

### Base Chain Specific Functions

For Base chains (Base Mainnet and Base Sepolia), the library provides additional functions for working with basenames according to ENSIP-19.

#### `BasenameSetter.getBasename()`

Gets the basename for a contract address on Base chains.

**Function Signature:**
```solidity
function getBasename(
    uint256 chainId,
    address contractAddress
) internal view returns (string memory basename)
```

**Example:**
```solidity
import {BasenameSetter} from "name-setter-lib/src/BasenameSetter.sol";
import {CommonUtils} from "name-setter-lib/src/CommonUtils.sol";

string memory basename = BasenameSetter.getBasename(
    CommonUtils.BASE_MAINNET,
    contractAddress
);
```

---

#### `BasenameSetter.basenameMatches()`

Checks if the existing basename matches a target basename.

**Function Signature:**
```solidity
function basenameMatches(
    uint256 chainId,
    address contractAddress,
    string memory targetBasename
) internal view returns (bool matches)
```

---

## Usage Patterns

### Pattern 1: Naming a Contract After Deployment

The most common use case is naming a contract immediately after deployment:

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import {Ens} from "name-setter-lib/src/Ens.sol";
import {CommonUtils} from "name-setter-lib/src/CommonUtils.sol";

contract MyDeployer {
    function deployAndName(
        address implementation,
        string memory name
    ) external returns (address deployed) {
        // Deploy your contract
        deployed = address(new MyContract(implementation));
        
        // Name it
        Ens.setName(
            block.chainid,
            deployed,
            name
        );
        
        return deployed;
    }
}
```

---

### Pattern 2: Wrapper Contract

Create a wrapper contract that exposes the library functions:

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import {Ens} from "name-setter-lib/src/Ens.sol";

contract EnsNamingWrapper {
    function setName(
        uint256 chainId,
        address contractAddress,
        string calldata fullName
    ) external {
        Ens.setName(chainId, contractAddress, fullName);
    }
    
    function setForwardOnly(
        uint256 chainId,
        address contractAddress,
        string calldata fullName
    ) external {
        Ens.setForwardResolution(chainId, contractAddress, fullName);
    }
}
```

---

### Pattern 3: Integration with Ownable Contracts

If your contract uses OpenZeppelin's `Ownable`, you can add a naming function:

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import {Ownable} from "@openzeppelin/contracts/access/Ownable.sol";
import {Ens} from "name-setter-lib/src/Ens.sol";

contract NamedContract is Ownable {
    string public ensName;
    
    function setName(string memory fullName) external onlyOwner {
        Ens.setName(block.chainid, address(this), fullName);
        ensName = fullName;
    }
}
```

---

## Important Considerations

### Access Control

- **Parent Domain Ownership**: The caller (`msg.sender`) must own the parent ENS domain. For example, to name a contract `myapp.mydomain.eth`, the caller must own `mydomain.eth`.

- **Zero Address Validation**: The library validates that `contractAddress` is not the zero address and will revert if it is.

### Chain-Specific Behavior

- **L1 Chains** (Ethereum, Optimism, Arbitrum, Scroll, Linea): Uses standard ENS reverse registrar
- **Base Chains**: Uses L2 reverse registrar and supports basename functionality according to ENSIP-19

### Gas Considerations

- The library functions are `internal`, so they are inlined at compile time (no additional gas cost for library calls)
- Operations involve multiple external calls to ENS contracts, so gas costs depend on ENS contract gas usage
- String operations (splitting, hashing) have gas costs proportional to name length

### Error Handling

The library uses `require()` statements that will revert the transaction if:
- The parent domain is not owned by the caller
- The contract address is zero
- The ENS name format is invalid
- Required ENS contracts are not available on the chain

### Reentrancy

If you're using this library in a contract with state variables, consider adding reentrancy guards if your contract handles funds or has other state that could be manipulated during external calls.

---

## Supported Networks

The library supports the following networks:

| Network | Chain ID | Mainnet | Testnet |
|---------|----------|---------|---------|
| Ethereum | 1 | ✅ | ✅ (Sepolia: 11155111) |
| Optimism | 10 | ✅ | ✅ (Sepolia: 11155420) |
| Arbitrum | 42161 | ✅ | ✅ (Sepolia: 421614) |
| Base | 8453 | ✅ | ✅ (Sepolia: 84532) |
| Scroll | 534352 | ✅ | ✅ (Sepolia: 534351) |
| Linea | 59144 | ✅ | ✅ (Sepolia: 59141) |

---

## Examples

### Complete Example: Deploy and Name

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import {Ens} from "name-setter-lib/src/Ens.sol";
import {CommonUtils} from "name-setter-lib/src/CommonUtils.sol";
import {Ownable} from "@openzeppelin/contracts/access/Ownable.sol";

contract ExampleContract is Ownable {
    string public name;
    
    constructor(address initialOwner) Ownable(initialOwner) {}
    
    function registerENSName(string memory fullName) external onlyOwner {
        require(
            Ens.setName(block.chainid, address(this), fullName),
            "ENS naming failed"
        );
        name = fullName;
    }
}
```

### Example: Multi-Chain Deployment Script

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import {Ens} from "name-setter-lib/src/Ens.sol";
import {CommonUtils} from "name-setter-lib/src/CommonUtils.sol";

contract MultiChainNamer {
    function nameOnMultipleChains(
        address contractAddress,
        string memory name
    ) external {
        // Name on Ethereum
        Ens.setName(CommonUtils.ETHEREUM_MAINNET, contractAddress, name);
        
        // Name on Base
        Ens.setName(CommonUtils.BASE_MAINNET, contractAddress, name);
        
        // Name on Optimism
        Ens.setName(CommonUtils.OPTIMISM_MAINNET, contractAddress, name);
    }
}
```

---

## Testing

The library includes comprehensive tests. You can run them with:

```bash
forge test
```

For integration testing, ensure you have ENS contracts deployed locally or use a testnet with proper ENS setup.

---

## Security

See [SECURITY_ANALYSIS.md](../SECURITY_ANALYSIS.md) for a detailed security analysis of the library.

Key security features:
- Zero address validation
- Access control checks
- Safe external calls with error handling
- No dangerous patterns (no `tx.origin`, `delegatecall`, etc.)

---

## Contributing

Contributions are welcome! Please ensure all tests pass and follow the existing code style.

---

## License

MIT
